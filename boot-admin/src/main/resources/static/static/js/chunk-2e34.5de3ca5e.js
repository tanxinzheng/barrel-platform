(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2e34"],{"144x":function(e,i,r){"use strict";r.r(i);var s=r("FyfS"),n=r.n(s),t=void 0,o={data:function(){return{listQuery:{keyword:"",pageSize:10,pageNum:1},fileList:[],groups:[],currentGroup:{},activeName:"user",dialogFormVisible:!1,formDisable:!1,formData:{},formRules:{groupName:[{required:!0,message:"请输入用户组名称",trigger:"blur"}],groupCode:[{required:!0,message:"请输入用户组代码",trigger:"blur"}]},listLoading:!0,dialogPermissionFormVisible:!1,users:[],bandingUsers:[],unBandingUsers:[],needBandingUsers:[],formPermissionDisable:!1,formPermissionRules:{permissionUrl:[{required:!0,message:"请输入URL",trigger:"blur"}],permissionAction:[{required:!0,message:"请输入操作类型",trigger:"blur"}]},permissionData:{},currentBindPermissions:[],permissionTree:[],permissionList:[]}},created:function(){(t=this).fetchData(),t.fetchPermission()},computed:{filterBandingUsers:function(){var e=this;return e.bandingUsers.filter(function(i){return-1!==i.username.indexOf(e.listQuery.keyword)})}},methods:{onSelect:function(e){t.fetchGroupBandingUsers(),t.fetchGroupUnBandingUsers(),t.getGroupPermissions()},savePermission:function(){t.$refs.formPermissionRef.validate(function(e){if(!e)return!1;t.permissionData.id?t.$API.updatePermission(t.permissionData).then(function(e){t.$alert("保存成功"),t.dialogPermissionFormVisible=!1,t.permissionData={}}):t.$API.createPermission(t.permissionData).then(function(e){t.$alert("删除成功"),t.dialogPermissionFormVisible=!1,t.permissionData={}})})},fetchGroupBandingUsers:function(){var e={groupId:t.currentGroup.id};t.$API.getGroupBandingUsers(e).then(function(e){t.bandingUsers=[];var i=!0,r=!1,s=void 0;try{for(var o,a=n()(e);!(i=(o=a.next()).done);i=!0){var l=o.value;l.key=l.id,l.label=l.nickname,t.bandingUsers.push(l)}}catch(e){r=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}})},fetchGroupUnBandingUsers:function(){var e={groupId:t.currentGroup.id};t.$API.getGroupUnBandingUsers(e).then(function(e){t.unBandingUsers=[];var i=!0,r=!1,s=void 0;try{for(var o,a=n()(e);!(i=(o=a.next()).done);i=!0){var l=o.value;l.key=l.id,l.label=l.nickname,t.unBandingUsers.push(l)}}catch(e){r=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}})},cancel:function(){t.dialogFormVisible=!1,t.formData={}},onAdd:function(){t.dialogFormVisible=!0},onDelete:function(e){t.$confirm("是否删除["+e.groupName+"]用户组?").then(function(i){t.$API.deleteUserGroup(e.id).then(function(e){t.$alert("删除成功"),t.fetchData()})})},onEdit:function(e){t.dialogFormVisible=!0,t.formDisable=!1,t.formData=e},onBindUsers:function(){t.currentGroup.id&&0!==t.needBandingUsers.length&&t.$API.bindUserGroups(t.currentGroup.id,t.needBandingUsers).then(function(e){t.needBandingUsers=[],t.fetchGroupBandingUsers(),t.fetchGroupUnBandingUsers(),t.$alert("绑定成功")})},onUnBindUsers:function(e){t.$confirm("是否移除["+e.nickname+"]用户?").then(function(i){t.$API.unBindUsers(t.currentGroup.id,[e.id]).then(function(e){t.fetchGroupBandingUsers(),t.fetchGroupUnBandingUsers(),t.$alert("解绑成功")})})},showPermission:function(){t.dialogPermissionFormVisible=!0},fetchPermission:function(){t.permissionTree=[],t.$API.getPermissions().then(function(e){t.permissionTree=e})},checkGroupPermission:function(e,i){var r=i.checkedKeys.find(function(i){return e.id===i});t.currentGroup.id&&r?t.$API.bindGroupPermission(t.currentGroup.id,[e.id]).then(function(e){console.log(t.currentBindPermissions)}):t.currentGroup.id&&!r&&t.$API.unbindGroupPermission(t.currentGroup.id,[e.id]).then(function(e){console.log(t.currentBindPermissions)})},getGroupPermissions:function(){t.$refs.permissionTreeRef.setCheckedKeys([]),t.$API.getGroupPermissions({groupId:t.currentGroup.id}).then(function(e){t.currentBindPermissions=[];for(var i=0;i<e.length;i++){var r=e[i];t.currentBindPermissions.push(r.id)}t.$refs.permissionTreeRef.setCheckedKeys(t.currentBindPermissions)})},save:function(){t.$refs.formInfoRef.validate(function(e){if(!e)return!1;t.formData.id?t.$API.updateUserGroup(t.formData).then(function(e){t.$alert("保存成功"),t.fetchData(),t.dialogFormVisible=!1}):t.$API.saveUserGroup(t.formData).then(function(e){t.$alert("保存成功"),t.fetchData(),t.dialogFormVisible=!1})})},fetchData:function(){t.$API.getUserGroups(t.listQuery).then(function(e){t.groups=e.data})}}},a=(r("Bynz"),r("KHd+")),l=Object(a.a)(o,function(){var e=this,i=e.$createElement,r=e._self._c||i;return r("div",{staticClass:"app-container group-card"},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:6}},[r("el-card",{staticClass:"box-card"},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("用户组")]),e._v(" "),r("el-button",{staticClass:"right-button",attrs:{type:"text"},on:{click:function(i){e.onAdd()}}},[e._v("新增")])],1),e._v(" "),e._l(e.groups,function(i){return r("div",{key:i.groupCode,staticClass:"item"},[r("el-radio",{attrs:{label:i},on:{change:function(r){e.onSelect(i)}},model:{value:e.currentGroup,callback:function(i){e.currentGroup=i},expression:"currentGroup"}},[e._v(e._s(i.groupName))]),e._v(" "),r("el-button",{staticClass:"right-button",attrs:{type:"text"},on:{click:function(r){e.onEdit(i)}}},[e._v("编辑")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:"SYSTEM"!==i.groupType,expression:"row.groupType !== 'SYSTEM'"}],staticClass:"right-button",attrs:{type:"text"},on:{click:function(r){e.onDelete(i)}}},[e._v("删除")])],1)})],2)],1),e._v(" "),r("el-col",{attrs:{span:18}},[r("el-card",{staticClass:"box-card"},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"header-item",class:{active:"user"===e.activeName},on:{click:function(i){e.activeName="user"}}},[e._v("用户")]),e._v(" "),r("span",{staticClass:"header-item",class:{active:"permission"===e.activeName},on:{click:function(i){e.activeName="permission"}}},[e._v("权限")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.currentGroup.id,expression:"!currentGroup.id"}]},[r("span",[e._v("请在左侧选择用户组")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"user"===e.activeName&&e.currentGroup.id,expression:"activeName === 'user' && currentGroup.id"}]},[r("div",{staticClass:"box-card-header"},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键词搜索",size:"small"},model:{value:e.listQuery.keyword,callback:function(i){e.$set(e.listQuery,"keyword",i)},expression:"listQuery.keyword"}}),e._v(" "),r("el-select",{attrs:{size:"small",height:"32px",multiple:"",filterable:"",placeholder:"请选择需要添加的用户"},model:{value:e.needBandingUsers,callback:function(i){e.needBandingUsers=i},expression:"needBandingUsers"}},e._l(e.unBandingUsers,function(e){return r("el-option",{key:e.id,attrs:{label:e.nickname,value:e.id}})})),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary",disabled:!e.currentGroup.id||0===e.needBandingUsers.length,icon:"el-icon-plus"},on:{click:function(i){e.onBindUsers()}}})],1),e._v(" "),r("div",{staticClass:"box-card-body"},e._l(e.filterBandingUsers,function(i){return r("div",{key:i.id,staticClass:"text item fontSize-14"},[e._v("\n              "+e._s(i.nickname)+"("+e._s(i.username)+")\n              "),r("el-button",{staticClass:"right-button",attrs:{type:"text"},on:{click:function(r){e.onUnBindUsers(i)}}},[e._v("移除")])],1)}))]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"permission"===e.activeName&&e.currentGroup.id,expression:"activeName === 'permission' && currentGroup.id"}]},[r("div",{staticClass:"box-card-header"},[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(i){e.showPermission()}}},[e._v("新增权限")])],1),e._v(" "),r("div",{staticClass:"box-card-body"},[r("el-tree",{ref:"permissionTreeRef",attrs:{data:e.permissionTree,"default-checked-keys":e.currentBindPermissions,"show-checkbox":"","node-key":"id",props:{children:"children",label:"description"}},on:{check:e.checkGroupPermission}})],1)])])],1)],1),e._v(" "),r("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"用户组"},on:{"update:visible":function(i){e.dialogFormVisible=i}}},[r("el-form",{ref:"formInfoRef",attrs:{model:e.formData,disabled:e.formDisable,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{prop:"groupCode",label:"用户组代码"}},[r("el-input",{attrs:{placeholder:"请输入用户组代码"},model:{value:e.formData.groupCode,callback:function(i){e.$set(e.formData,"groupCode",i)},expression:"formData.groupCode"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"groupName",label:"用户组名称"}},[r("el-input",{attrs:{placeholder:"请输入用户组名称"},model:{value:e.formData.groupName,callback:function(i){e.$set(e.formData,"groupName",i)},expression:"formData.groupName"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(i){e.cancel()}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(i){e.save()}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{attrs:{visible:e.dialogPermissionFormVisible,title:"权限"},on:{"update:visible":function(i){e.dialogPermissionFormVisible=i}}},[r("el-form",{ref:"formPermissionRef",attrs:{model:e.permissionData,disabled:e.formPermissionDisable,rules:e.formPermissionRules,"label-width":"100px"}},[r("el-form-item",{attrs:{prop:"permissionUrl",label:"权限URL"}},[r("el-input",{attrs:{placeholder:"请输入URL"},model:{value:e.permissionData.permissionUrl,callback:function(i){e.$set(e.permissionData,"permissionUrl",i)},expression:"permissionData.permissionUrl"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"permissionGroup",label:"权限组"}},[r("el-input",{attrs:{placeholder:"请输入权限组"},model:{value:e.permissionData.permissionGroup,callback:function(i){e.$set(e.permissionData,"permissionGroup",i)},expression:"permissionData.permissionGroup"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"description",label:"权限描述"}},[r("el-input",{attrs:{placeholder:"请输入权限描述"},model:{value:e.permissionData.description,callback:function(i){e.$set(e.permissionData,"description",i)},expression:"permissionData.description"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"active",label:"是否启用"}},[r("el-switch",{attrs:{"active-text":"已启用","inactive-text":"未启用"},model:{value:e.permissionData.active,callback:function(i){e.$set(e.permissionData,"active",i)},expression:"permissionData.active"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(i){e.dialogPermissionFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(i){e.savePermission()}}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"3094bf0e",null);l.options.__file="role.vue";i.default=l.exports},Bynz:function(e,i,r){"use strict";var s=r("TuPg");r.n(s).a},TuPg:function(e,i,r){}}]);